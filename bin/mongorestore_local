#!/usr/bin/env node
// Generated by LiveScript 1.4.0
(function(){
  var fs, mongoUri, exec, dumpdir, mongourl, meteorsite, meteorsitebase, mkrestore, i$, ref$, len$, dbpath;
  fs = require('fs');
  mongoUri = require('mongo-uri');
  exec = require('shelljs').exec;
  dumpdir = process.argv[2];
  if (dumpdir == null) {
    console.log('need to provide dumpdir');
    process.exit();
  }
  if (!fs.existsSync(dumpdir)) {
    console.log('dumpdir does not exist: ' + dumpdir);
    process.exit();
  }
  mongourl = 'mongodb://localhost:27017/default';
  meteorsite = meteorsitebase = 'local';
  console.log('mongourl: ' + mongourl);
  mkrestore = function(uri, dumppath){
    var login, host;
    login = mongoUri.parse(uri);
    if (login.database == null) {
      login.database = 'default';
    }
    host = login['hosts'][0] + ':' + login['ports'][0];
    return exec('mongorestore --drop --db #{login.database} --host ' + host + " '" + dumppath + "'");
  };
  for (i$ = 0, len$ = (ref$ = fs.readdirSync(dumpdir)).length; i$ < len$; ++i$) {
    dbpath = ref$[i$];
    console.log(dumpdir + '/' + dbpath);
    mkrestore(mongourl, dumpdir + "/" + dbpath);
  }
}).call(this);
