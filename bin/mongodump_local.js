// Generated by LiveScript 1.4.0
(function(){
  var fs, mongoUri, ref$, run, exec, datecmd, curdate, mongourl, meteorsite, meteorsitebase, listcollections, all_collections, mkexport, i$, len$, collection;
  fs = require('fs');
  mongoUri = require('mongo-uri');
  ref$ = require('execSync'), run = ref$.run, exec = ref$.exec;
  datecmd = 'date';
  if (fs.existsSync('/usr/local/bin/gdate')) {
    datecmd = '/usr/local/bin/gdate';
  }
  curdate = exec(datecmd + ' --rfc-3339=seconds').stdout.split(' ').join('_').trim();
  mongourl = 'mongodb://localhost:27017';
  meteorsite = meteorsitebase = 'local';
  console.log('mongourl: ' + mongourl);
  listcollections = function(uri){
    var login, host;
    login = mongoUri.parse(uri);
    host = login['hosts'][0] + ':' + login['ports'][0];
    return exec("mongo " + host + " --eval 'db.getCollectionNames()'").stdout.trim().split('\n').filter(function(x){
      return x.indexOf('MongoDB shell version') === -1 && x.indexOf('connecting to:') === -1;
    }).join('\n').split(',');
  };
  console.log('collections:');
  all_collections = listcollections(mongourl);
  console.log(all_collections);
  if (all_collections.length === 0) {
    console.log('no collections to dump');
    process.exit();
  }
  mkexport = function(uri, collection){
    var login, host;
    login = mongoUri.parse(uri);
    host = login['hosts'][0] + ':' + login['ports'][0];
    return run('mongodump -h ' + host + " -c " + collection + " -o '" + dumpdir + "'");
  };
  for (i$ = 0, len$ = all_collections.length; i$ < len$; ++i$) {
    collection = all_collections[i$];
    mkexport(mongourl, collection);
  }
}).call(this);
